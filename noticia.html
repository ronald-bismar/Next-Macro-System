<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/animate.css" />
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/estilos.css" />
    <link rel="stylesheet" href="css/estilos-sobre-nosotros.css" />
    <link rel="stylesheet" href="css/animaciones.css" />

    <link
      rel="stylesheet"
      href="css/por-secciones/pie-de-pagina/pie-de-pagina.css"
    />
    <link
      rel="stylesheet"
      href="css/por-secciones/pie-de-pagina/animacion.css"
    />
    <link rel="stylesheet" href="robotito/robotito-feliz.css" />
    <link rel="stylesheet" href="CSS/font-awesome.min.css" />
    <link rel="icon" href="img/logo.png" type="image/png" />
    <script src="js/fontawesome.min.js"></script>
    <title>Next Macro System</title>
  </head>

  <body>
    <header-next-macro-system
      scroll-effect="false"
      fixed="false"
    ></header-next-macro-system>
    <section class="sobre-nosotros mt-3 text-dark text-center px-5">
      <main class="noticias mx-5 px-5" id="post-detail-container">
        <div class="text-center w-100 mt-5">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Cargando...</span>
          </div>
        </div>
      </main>

      <script src="components/header.js"></script>
      <script>
        document.addEventListener("DOMContentLoaded", () => {
          const container = document.getElementById("post-detail-container");
          const urlParams = new URLSearchParams(window.location.search);
          const postId = urlParams.get("id");
          const apiUrl = "https://blog-nmsystem.vercel.app/blogs";

          if (!postId) {
            container.innerHTML =
              '<div class="alert alert-warning text-center">No se especificó ninguna noticia. <a href="blog.html">Volver al blog</a></div>';
            return;
          }

          fetch(apiUrl)
            .then((response) => {
              if (!response.ok) {
                throw new Error("Network response was not ok");
              }
              return response.json();
            })
            .then((posts) => {
              const post = posts.find((p) => p.id === postId);

              if (!post) {
                container.innerHTML =
                  '<div class="alert alert-warning text-center">Noticia no encontrada. <a href="blog.html">Volver al blog</a></div>';
                return;
              }

              // Update page title
              document.title = post.title;

              const imageSrc = post.imagePost || "img/logo.png";

              let contentHtml = "";

              if (post.section && post.section.length > 0) {
                // Sort by order
                post.section.sort((a, b) => a.order - b.order);

                post.section.forEach((sec) => {
                  if (sec.subtitle) {
                    contentHtml += `<h3 class="mt-4 mb-3">${sec.subtitle}</h3>`;
                  }
                  if (sec.image) {
                    contentHtml += `<img src="${
                      sec.image
                    }" class="img-fluid my-3 d-block mx-auto" alt="${
                      sec.subtitle || "Imagen de la sección"
                    }" style="max-height: 400px;" />`;
                  }
                  if (sec.paragraph) {
                    // Convert newlines to line breaks for better formatting
                    const formattedParagraph = sec.paragraph.replace(
                      /\n/g,
                      "<br>"
                    );
                    contentHtml += `<p>${formattedParagraph}</p>`;
                  }
                });
              } else if (post.subtitle) {
                // Fallback if no sections but subtitle exists
                contentHtml = `<p class="lead">${post.subtitle}</p>`;
              }

              container.innerHTML = `
                <div class="noticia my-4">
                    <h2>${post.title}</h2>
                    <div class="text-muted mb-3">
                        <small>Por ${post.author} | ${post.datePost} | ${post.timeRead}</small>
                    </div>
                    <img
                        src="${imageSrc}"
                        alt="${post.title}"
                        class="img-fluid px-5 px-md-5 mb-4 w-100"
                        style="max-height: 500px; object-fit: cover;"
                        onerror="this.onerror=null;this.src='img/logo.png';"
                    />
                    <div class="my-5" style="font-weight: 400; text-align: justify;">
                        ${contentHtml}
                    </div>
                    <div class="text-center mt-5">
                        <a href="blog.html" class="btn btn-secondary">Volver al Blog</a>
                    </div>
                </div>
            `;
            })
            .catch((error) => {
              console.error("Error fetching post:", error);
              container.innerHTML =
                '<div class="alert alert-danger text-center">Error al cargar la noticia. <a href="blog.html">Volver al blog</a></div>';
            });
        });
      </script>
    </section>
  </body>
</html>
